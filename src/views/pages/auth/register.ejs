<h1 class="h3 mb-4">Регистрация</h1>
<%- include('../../partials/flash') %>

<form action="/register" method="POST" class="needs-validation" novalidate>
    <div class="mb-3">
        <label for="name" class="form-label">Имя</label>
        <input
                id="name"
                name="name"
                type="text"
                class="form-control"
                placeholder="Ваше имя"
                value="<%= oldData?.name || '' %>"
                required
        >
        <div class="invalid-feedback">Имя обязательно.</div>
    </div>

    <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input
                id="email"
                name="email"
                type="email"
                class="form-control"
                placeholder="you@example.com"
                value="<%= oldData?.email || '' %>"
                required
        >
        <div class="invalid-feedback">Нужно валидное email-адрес.</div>
    </div>

    <div class="mb-3">
        <label for="password" class="form-label">Пароль</label>
        <input
                id="password"
                name="password"
                type="password"
                class="form-control"
                placeholder="Минимум 6 символов"
                required
                minlength="6"
        >
        <div class="invalid-feedback">Пароль минимум 6 символов.</div>
    </div>

    <div class="mb-4">
        <label for="password2" class="form-label">Повторите пароль</label>
        <input
                id="password2"
                name="password2"
                type="password"
                class="form-control"
                placeholder="Ещё раз пароль"
                required
        >
        <div class="invalid-feedback">Пароли должны совпадать.</div>
    </div>

    <button type="submit" class="btn btn-primary w-100">Зарегистрироваться</button>
</form>

<p class="mt-3 text-center">
    Уже есть аккаунт? <a href="/login" class="link-light">Войти</a>
</p>

<script>
    // Bootstrap client‐side validation
    (() => {
        'use strict'
        const forms = document.querySelectorAll('.needs-validation')
        Array.from(forms).forEach(f => {
            f.addEventListener('submit', e => {
                if (!f.checkValidity() || f.password.value !== f.password2.value) {
                    e.preventDefault()
                    e.stopPropagation()
                    if (f.password.value !== f.password2.value) {
                        f.password2.setCustomValidity('Пароли не совпадают')
                    }
                }
                f.classList.add('was-validated')
            }, false)
        })
    })()
</script>
